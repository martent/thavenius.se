## Let's encrypt cert
# # If needed, generate snakeoil certs first
# sudo openssl req \
#        -newkey rsa:2048 -nodes -keyout /etc/ssl/private/ssl-cert-snakeoil.key \
#        -x509 -days 365 -out /etc/ssl/certs/ssl-cert-snakeoil.crt
#
# sudo certbot --nginx
# sudo certbot renew

# Applies to all vhosts on :80
server {
  listen 80 default_server;
  listen [::]:80 default_server;

  if ($http_host ~* "^www\."){
      return 301 https://$host$request_uri;
  }

  if ($scheme != "https") {
      return 301 https://$host$request_uri;
  }
}

server {
  server_name thavenius.se www.thavenius.se thavenius.com www.thavenius.com;
  listen 443 ssl;
  root /home/app_runner/webapps/thavenius.se;

  # ssl_certificate /etc/ssl/certs/ssl-cert-snakeoil.crt;
  # ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;
  ssl_certificate /etc/letsencrypt/live/thavenius.se/fullchain.pem; # managed by Certbot
  ssl_certificate_key /etc/letsencrypt/live/thavenius.se/privkey.pem; # managed by Certbot

  add_header X-UA-Compatible "IE=Edge";
}
